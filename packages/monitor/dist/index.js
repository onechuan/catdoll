var webMonitorSdk=function(e){"use strict";var t=window.fetch;function n(){window.fetch=function(e,n){return Date.now(),null==n||n.method,t(e,n).then((function(e){return e.clone(),e.status,e.ok,e})).catch((function(e){return e.status,new Response(null,{status:e.status})}))}}var r=[];var o={url:"http://127.0.0.1:3000/api",projectName:"webMonitorSdk",appId:"20000902",userId:"90081",isImageUpload:!1,batchSize:5};function a(){return"id-"+Date.now()+"-"+Math.random().toString(36).substring(2,9)}var i=XMLHttpRequest.prototype.open,s=XMLHttpRequest.prototype.send;function c(e){o.url||console.error("请设置上传url地址");var t=JSON.stringify({id:a(),data:e});if(o.isImageUpload)!function(e){(new Image).src="".concat(o.url,"?data=").concat(encodeURIComponent(JSON.stringify(e)))}(t);else{if(window.navigator.sendBeacon)return function(e){window.requestIdleCallback?window.requestIdleCallback((function(){window.navigator.sendBeacon(o.url,e)}),{timeout:3e3}):setTimeout((function(){window.navigator.sendBeacon(o.url,e)}))}(t);!function(e,t){window.requestIdleCallback?window.requestIdleCallback((function(){var n=new XMLHttpRequest;i.call(n,"post",e,!0),s.call(n,JSON.stringify(t))}),{timeout:3e3}):setTimeout((function(){var n=new XMLHttpRequest;i.call(n,"post",e,!0),s.call(n,JSON.stringify(t))}))}(o.url,t)}}function u(e){!function(e){r.push(e)}(e);var t=r;console.error("cacheData",t),t.length&&t.length>o.batchSize&&(c(t),r.length=0)}function d(){var e=new PerformanceObserver((function(t){for(var n=t.getEntries(),r=0,o=n;r<o.length;r++){o[r];for(var a=0,i=n;a<i.length;a++){var s=i[a];e&&e.disconnect();var c={name:s.name,type:"performance",subType:s.subType,sourceType:s.entryType,duration:s.duration,dns:s.domainLookupEnd-s.domainLookupStart,tcp:s.connectEnd-s.connectStart,redirect:s.redirectEnd-s.redirectStart,ttfb:s.responseStart,protocol:s.nextHopProtocol,responseBodySize:s.responseBodySize,responseHeaderSize:s.transferSize-s.encodedBodySize,transferSize:s.transferSize,resourceSize:s.decodedBodySize,startTime:performance.now()};console.log("entry",s),u(c)}}}));e.observe({type:"resource",buffered:!0})}var f=function(){return f=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},f.apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError;var p=XMLHttpRequest.prototype,l=p.open,w=p.send;function m(){p.open=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.method=e[0],this.url=e[1],l.apply(this,e)},p.send=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.startTime=Date.now();var r=function(){e.endTime=Date.now(),e.duration=e.endTime-e.startTime;var t=e,n=t.status,o=t.duration,a=t.method,i=t.url,s=t.startTime,c=t.endTime;u({type:"performance",subType:"xhr",success:n>=200&&n<300,method:a.toUpperCase(),status:n,duration:o,url:i,startTime:s,endTime:c}),e.removeEventListener("loaded",r,!0)};this.addEventListener("loaded",r,!0),w.apply(this,t)}}function v(){var e;n(),function(){if("complete"===document.readyState)d();else{var e=function(){d(),window.removeEventListener("load",e,!0)};window.addEventListener("load",e,!0)}}(),(e=new PerformanceObserver((function(t){for(var n=0,r=t.getEntries();n<r.length;n++){var o=r[n];if("first-contentful-paint"===o.name){e.disconnect();var a=o.toJSON();console.log("entryJson",a),u(f(f({},a),{type:"performance",subType:o.name,pageUrl:window.location.href}))}}}))).observe({type:"paint",buffered:!0}),function(){var e=new PerformanceObserver((function(t){for(var n=0,r=t.getEntries();n<r.length;n++){var o=r[n];if("largest-contentful-paint"===o.name){e.disconnect();var a=o.toJSON();console.log("entryJson",a),u(f(f({},a),{type:"performance",subType:o.name,pageUrl:window.location.href}))}}}));e.observe({type:"largest-contentful-paint",buffered:!0})}(),function(){var e=new PerformanceObserver((function(t){for(var n=0,r=t.getEntries();n<r.length;n++){var o=r[n];if("first-paint"===o.name){e.disconnect();var a=o.toJSON();console.log("entryJson",a),u(f(f({},a),{type:"performance",subType:o.name,pageUrl:window.location.href}))}}}));e.observe({type:"paint",buffered:!0})}(),window.addEventListener("pageshow",(function(e){requestAnimationFrame((function(){["load"].forEach((function(t){u({type:"performance",subType:t,pageUrl:window.location.href,startTime:performance.now()-e.timeStamp})}))}))}),!0),m()}function h(){window.addEventListener("error",(function(e){var t=e.target;t&&((t.src||t.href)&&u({type:"error",subType:"resource",url:t.src||t.href,html:t.outerHTML,pageUrl:window.location.href,paths:e.path}))}),!0),window.onerror=function(e,t,n,r,o){u({type:"error",subType:"js",msg:e,url:t,lineNo:n,columnNo:r,stack:o.stack||"",pageUrl:window.location.href,startTime:performance.now()})},window.addEventListener("unhandledrejection",(function(e){u({type:"error",subType:"promise",msg:e.reason,pageUrl:window.location.href,startTime:e.timeStamp})}),!0)}function y(){["mousedown","touchstart"].forEach((function(e){window.addEventListener(e,(function(t){var n=t.target,r=t.composedPath?t.composedPath():void 0;n&&n.tagName&&u({type:"behavior",subType:"click",target:n.tagName,startTime:t.timeStamp,innerHtml:n.innerHTML,outerHtml:n.outerHTML,with:n.offsetWidth,height:n.offsetHeight,eventType:e,path:r})}),!0)})),u({type:"behavior",subType:"pv",pageUrl:window.location.href,startTime:performance.now(),referrer:document.referrer,uuid:a()}),function(){var e="";window.addEventListener("hashchange",(function(t){var n=t.newURL;u({type:"behavior",subType:"pageChange",from:e,to:n,startTime:performance.now(),uuid:a()}),e=n}),!0);var t="";window.addEventListener("popstate",(function(e){var n=window.location.href;u({from:t,to:n,type:"behavior",subType:"popstate",startTime:performance.now(),uuid:a()}),t=n}),!0)}()}function g(e,t){if(!window.__webMonitorSdk__.vue){window.__webMonitorSdk__.vue=!0;var n=e.config.errorHandler;e.config.errorHandler=function(e,t,r){u({info:r,error:e.stack,subType:"vue",type:"error",startTime:window.performance.now(),pageUrl:window.location.href}),n&&n.call(this,e,t,r)}}}function b(e,t){window.__webMonitorSdk__.react||(window.__webMonitorSdk__.react=!0,u({error:e.stack,info:t,subType:"react",type:"error",startTime:window.performance.now(),pageUrl:window.location.href}))}function T(e){!function(e){for(var t in console.log("setConfig",e),o)e[t]&&(o[t]=e[t])}(e),v(),h(),y()}window.__webMonitorSdk__={version:"0.0.1",vue:!1,react:!1};var S={install:g,performance:v,error:h,init:T,behavior:y,errorBoundary:b};return e.default=S,e.errorBoundary=b,e.init=T,e.install=g,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
//# sourceMappingURL=index.js.map
