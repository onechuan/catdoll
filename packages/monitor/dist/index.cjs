"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=window.fetch;function t(){window.fetch=function(t,n){return Date.now(),null==n||n.method,e(t,n).then((function(e){return e.clone(),e.status,e.ok,e})).catch((function(e){return e.status,new Response(null,{status:e.status})}))}}var n=[];var r={url:"http://127.0.0.1:3000/reportData",projectName:"webMonitorSdk",appId:"20000902",userId:"90081",isImageUpload:!1,batchSize:5};function o(){return"id-"+Date.now()+"-"+Math.random().toString(36).substring(2,9)}var a=XMLHttpRequest.prototype.open,i=XMLHttpRequest.prototype.send;function s(e){if(r.url){var t=JSON.stringify({id:o(),data:e});if(r.isImageUpload)!function(e){(new Image).src="".concat(r.url,"?data=").concat(encodeURIComponent(JSON.stringify(e)))}(t);else{if(window.navigator.sendBeacon)return function(e){window.requestIdleCallback?window.requestIdleCallback((function(){window.navigator.sendBeacon(r.url,e)}),{timeout:3e3}):setTimeout((function(){window.navigator.sendBeacon(r.url,e)}))}(t);!function(e,t){window.requestIdleCallback?window.requestIdleCallback((function(){var n=new XMLHttpRequest;a.call(n,"post",e,!0),i.call(n,JSON.stringify(t))}),{timeout:3e3}):setTimeout((function(){var n=new XMLHttpRequest;a.call(n,"post",e,!0),i.call(n,JSON.stringify(t))}))}(r.url,t)}}else console.error("请设置上传url地址")}function c(e){!function(e){n.push(e)}(e);var t=n;console.error("cacheData",t),t.length&&t.length>r.batchSize&&(s(t),n.length=0)}function u(){var e=new PerformanceObserver((function(t){for(var n=t.getEntries(),r=0,o=n;r<o.length;r++){o[r];for(var a=0,i=n;a<i.length;a++){var s=i[a];e&&e.disconnect();var u={name:s.name,type:"performance",subType:s.subType,sourceType:s.entryType,duration:s.duration,dns:s.domainLookupEnd-s.domainLookupStart,tcp:s.connectEnd-s.connectStart,redirect:s.redirectEnd-s.redirectStart,ttfb:s.responseStart,protocol:s.nextHopProtocol,responseBodySize:s.responseBodySize,responseHeaderSize:s.transferSize-s.encodedBodySize,transferSize:s.transferSize,resourceSize:s.decodedBodySize,startTime:performance.now()};console.log("entry",s),c(u)}}}));e.observe({type:"resource",buffered:!0})}var d=function(){return d=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},d.apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError;var p=XMLHttpRequest.prototype,f=p.open,l=p.send;function w(){p.open=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.method=e[0],this.url=e[1],f.apply(this,e)},p.send=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.startTime=Date.now();var r=function(){e.endTime=Date.now(),e.duration=e.endTime-e.startTime;var t=e,n=t.status,o=t.duration,a=t.method,i=t.url,s=t.startTime,u=t.endTime;c({type:"performance",subType:"xhr",success:n>=200&&n<300,method:a.toUpperCase(),status:n,duration:o,url:i,startTime:s,endTime:u}),e.removeEventListener("loaded",r,!0)};this.addEventListener("loaded",r,!0),l.apply(this,t)}}function m(){["mousedown","touchstart"].forEach((function(e){window.addEventListener(e,(function(t){var n=t.target,r=t.composedPath?t.composedPath():void 0;n&&n.tagName&&c({type:"behavior",subType:"click",target:n.tagName,startTime:t.timeStamp,innerHtml:n.innerHTML,outerHtml:n.outerHTML,with:n.offsetWidth,height:n.offsetHeight,eventType:e,path:r})}),!0)})),function(){var e="";window.addEventListener("hashchange",(function(t){var n=t.newURL;c({type:"behavior",subType:"pageChange",from:e,to:n,startTime:performance.now(),uuid:o()}),e=n}),!0);var t="";window.addEventListener("popstate",(function(e){var n=window.location.href;c({from:t,to:n,type:"behavior",subType:"popstate",startTime:performance.now(),uuid:o()}),t=n}),!0)}(),c({type:"behavior",subType:"pv",pageUrl:window.location.href,startTime:performance.now(),referrer:document.referrer,uuid:o()})}function v(e,t){if(!window.__webMonitorSdk__.vue){window.__webMonitorSdk__.vue=!0;var n=e.config.errorHandler;e.config.errorHandler=function(e,t,r){var o={info:r,error:e.stack,subType:"vue",type:"error",startTime:window.performance.now(),pageUrl:window.location.href};console.log("vue error",o),c(o),n&&n.call(this,e,t,r)}}}function h(e,t){window.__webMonitorSdk__.react||(window.__webMonitorSdk__.react=!0,c({error:e.stack,info:t,subType:"react",type:"error",startTime:window.performance.now(),pageUrl:window.location.href}))}function y(e){!function(e){for(var t in console.error("config options",e),r)e[t]&&(r[t]=e[t])}(e),m()}window.__webMonitorSdk__={version:"0.0.1",vue:!1,react:!1};var g={install:v,errorBoundary:h,init:y,error:function(){window.addEventListener("error",(function(e){var t=e.target;t&&((t.src||t.href)&&c({type:"error",subType:"resource",url:t.src||t.href,html:t.outerHTML,pageUrl:window.location.href,paths:e.path}))}),!0),window.onerror=function(e,t,n,r,o){c({type:"error",subType:"js",msg:e,url:t,lineNo:n,columnNo:r,stack:o.stack||"",pageUrl:window.location.href,startTime:performance.now()})},window.addEventListener("unhandledrejection",(function(e){c({type:"error",subType:"promise",msg:e.reason,pageUrl:window.location.href,startTime:e.timeStamp})}),!0)},behavior:m,performance:function(){var e;t(),function(){if("complete"===document.readyState)u();else{var e=function(){u(),window.removeEventListener("load",e,!0)};window.addEventListener("load",e,!0)}}(),(e=new PerformanceObserver((function(t){for(var n=0,r=t.getEntries();n<r.length;n++){var o=r[n];if("largest-contentful-paint"===o.name){e.disconnect();var a=o.toJSON();console.log("entryJson",a),c(d(d({},a),{type:"performance",subType:o.name,pageUrl:window.location.href}))}}}))).observe({type:"largest-contentful-paint",buffered:!0}),function(){var e=new PerformanceObserver((function(t){for(var n=0,r=t.getEntries();n<r.length;n++){var o=r[n];if("first-contentful-paint"===o.name){e.disconnect();var a=o.toJSON();console.log("entryJson",a),c(d(d({},a),{type:"performance",subType:o.name,pageUrl:window.location.href}))}}}));e.observe({type:"paint",buffered:!0})}(),window.addEventListener("pageshow",(function(e){requestAnimationFrame((function(){["load"].forEach((function(t){c({type:"performance",subType:t,pageUrl:window.location.href,startTime:performance.now()-e.timeStamp})}))}))}),!0),function(){var e=new PerformanceObserver((function(t){for(var n=0,r=t.getEntries();n<r.length;n++){var o=r[n];if("first-paint"===o.name){e.disconnect();var a=o.toJSON();console.log("entryJson",a),c(d(d({},a),{type:"performance",subType:o.name,pageUrl:window.location.href}))}}}));e.observe({type:"paint",buffered:!0})}(),w()}};exports.default=g,exports.errorBoundary=h,exports.init=y,exports.install=v;
//# sourceMappingURL=index.cjs.map
